# Сервис сбора метрик и алертинга

Разработан сервер + агент (клиент). Ближайший аналог - node exporter. Это пример учебного большого проекта, который был выполнен в рамках прохождения курса "Продвинутый Go-разработчик" на Яндекс.Пактикуме. Все работы по проекту были завершены в срок (двухнедельные спринты) на протяжении всего курса с 29.11.2023 по 19.06.2024.

Особенностью сдачи инкрементов и всей работы была необходимость пройти автоматические тесты от курса, которые размещались прямо в репозиториях, как и прямо в этом репозитоории, которые запускаются Github Actions ([README автотестов](https://github.com/Yandex-Practicum/go-autotests)), и только после этого работу можно было передать на ревью.

Кроме этого, хотелось бы отметить, что:

1. На первых спринтах не допускалось использование внешних пакетов и иные ограничения, требования каждого спринта, и были строгие дедлайны, так как в последующие 2 недели уже новая теория и новые инкременты - все без сдвига общего срока вправо, иначе только переход на сводобный график или перевод в новые группы, которые стартовали следом за нами.
2. Требовалось обеспечить обратную совместимость - каждый новый спринт, каждая новая фича добавляла функционал, а не заменяла его, что проверялось автоматическими тестами, так как каждая новая ветка проходила все тесты с самых первых и до соответствующего спринту теста.
3. Нас приучили въедливо разбирать лог ошибок автоматических тестов, чтобы можно пофиксить баги, решить задачи спринта, апрувиться по мерж реквесту у ментора и получить возможность перейти к новому спринту.

Пример этой работы - это реально очень большая практика в условиях приближенных к рабочим, когда все зашиваются и нужно постараться не перегружать коллег, найти решение и сделать свою задачу самостоятельно. В крайнем случае - обсуждение 1:1 или с коллегами в каналах комьюнити. 

## Фичи сервера

- [x] Запись в память или в PostgreSQL с использованием слоя `storage`
- [x] Синхронная и асинхронная запись в файл с восстановлением из файла
- [x] Работа с дефолтным веб-сервером, включая routes и `middleware` или внешним
- [x] Прием метрик в текстовом и json форматах
- [x] Прием метрик батчами
- [x] Ответы сервера регламентированным кодом и статусом
- [x] Логирование входящих запросов и ответов через `middleware` - uri, method, status, duration, size
- [x] Retriable-подключение к PostreSQL
- [x] Оптимизация с использованием профилировщика pprof
- [x] Проверка доверенной подсети для приема метрик

## Фичи агента

- [x] Источник метрик из пакета `runtime`, `gopsutil` и кастомные метрики
- [x] Источник типа `gauge`, `float64` — новое значение должно замещать предыдущее
- [x] Источник типа `counter`, `int64` — новое значение должно добавляться к предыдущему 
- [x] Полинг и отправка метрик с заданным интервалом времени 
- [x] Отправка данных в текстовом и json форматах
- [x] Отправка данных батчами

## Общие фичи для сервера и агента

- [x] Для конфигурирования используются env, флаги и json-файл
- [x] Поддержка gzip для передачи и приема тестовых и json форматов данных
- [x] Подпись данных по алгоритму SHA256
- [x] Поддержка ассиметричного шифрования
- [x] Сформирован свой статический анализатор кода, весь код ему соответствует, добавлена документация к нему в формате godoc. Состоит из всех анализаторов пакета `golang.org/x/tools/go/analysis/passes`, всех анализаторов класса `SA` пакета `staticcheck.io`, 2-х публичных анализаторов `errwrap`, `noctx` и одного собственного анализатора, запрещающий использовать прямой вызов `os.Exit` в функции `main` пакета `main`.
- [x] Реазиован gracefull shutdown - данные, которые находятся в процессе обработки на момент получения сигнала, успешно передаются агентом на сервер, а сервер успешно сохраняет все несохранённые данные
- [x] Поддержка обмена данными по gRPC - всех возможностей конфигурации gRPC-сервера и агента аналогично конфигурациям HTTP-сервера

## Начало работы

1. Склонируйте репозиторий в любую подходящую директорию на вашем компьютере.

Далее в зависимости от среды запуска:

## В любой IDE, где уже может исполняться код на Go.

1. Выполните команду `go run ./cmd/server/` для запуска сервера
2. Выполните команду `go run ./cmd/agent/` для запуска агента

## MacOS, создание исполняемых файлов

1. Для создания исполняемого файла сервера `go build -o ./cmd/server/server ./cmd/server/*.go`
2. Для файла агента `go build -o ./cmd/server/agent ./cmd/agent/*.go`

## Тестирование

1. В корне репозитория выполните команду `go test -v -race ./...` для выполнения локальных тестов и определения Race Condition.
